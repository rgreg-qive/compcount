(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();class E{constructor(e){this.token=e}static parseUrl(e){try{const t=new URL(e),o=t.pathname.split("/")[2],s=t.searchParams.get("node-id");if(!s)throw new Error("node-id nÃ£o encontrado na URL");const a=s.replace("-",":");return{fileKey:o,nodeId:a}}catch(t){return console.error("Erro ao analisar URL do Figma:",t),null}}async fetchFrame(e,t){try{const n=await fetch(`https://api.figma.com/v1/files/${e}/nodes?ids=${t}`,{headers:{"X-Figma-Token":this.token}});if(!n.ok)throw new Error(`Erro da API do Figma: ${n.status} ${n.statusText}`);const s=(await n.json()).nodes[t];if(!s||!s.document)throw new Error("Frame nÃ£o encontrado");return s.document}catch(n){throw console.error("Erro ao buscar frame do Figma:",n),n}}async validateToken(){try{return(await fetch("https://api.figma.com/v1/me",{headers:{"X-Figma-Token":this.token}})).ok}catch(e){return console.error("Erro ao validar token:",e),!1}}}const h=class h{static savePattern(e){const n=this.getPatterns().filter(o=>o.frameId!==e.frameId);n.push(e),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}static getPatterns(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Erro ao recuperar padrÃµes:",e),[]}}static getPatternByFrameId(e){return this.getPatterns().find(n=>n.frameId===e)||null}static addFeedbackToPattern(e,t){const n=this.getPatterns(),o=n.findIndex(s=>s.frameId===e);if(o!==-1){n[o].feedback||(n[o].feedback=[]),n[o].feedback.push(t);const s=this.generateRulesFromFeedback(t);s.length>0&&(this.saveAnalysisRules(s),n[o].analysisRules||(n[o].analysisRules=[]),n[o].analysisRules.push(...s)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n)),this.autoSaveFeedbackToFile(e,t)}}static autoSaveFeedbackToFile(e,t){const n={timestamp:new Date().toISOString(),frameId:e,feedback:t,userAgent:navigator.userAgent,sessionId:this.getOrCreateSessionId()},o=`figma-feedback-${e}-${Date.now()}.json`,s=JSON.stringify(n,null,2);this.downloadFile(s,o,"application/json"),console.log("ðŸ“¤ Feedback salvo automaticamente:",o)}static getOrCreateSessionId(){const e="figma-analysis-session-id";let t=localStorage.getItem(e);return t||(t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(e,t)),t}static generateRulesFromFeedback(e){const t=[],n=`rule_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;switch(e.type){case"missed_component":e.componentName&&(t.push({id:n,type:"include",condition:{nodeName:e.componentName},action:{classify:e.expectedClassification||"disconnected"},confidence:.8,source:"user_feedback",createdAt:Date.now()}),e.componentName.includes("Rectangle")&&t.push({id:`${n}_pattern`,type:"include",condition:{namePattern:"Rectangle.*"},action:{classify:e.expectedClassification||"disconnected"},confidence:.6,source:"user_feedback",createdAt:Date.now()}));break;case"wrong_classification":e.componentName&&t.push({id:n,type:"classify",condition:{nodeName:e.componentName},action:{classify:e.expectedClassification||"disconnected"},confidence:.9,source:"user_feedback",createdAt:Date.now()});break;case"should_ignore":e.componentName&&t.push({id:n,type:"exclude",condition:{nodeName:e.componentName},action:{ignore:!0},confidence:.9,source:"user_feedback",createdAt:Date.now()});break}return t}static saveAnalysisRules(e){const o=[...this.getAnalysisRules(),...e].filter((s,a,r)=>a===r.findIndex(i=>i.id===s.id));localStorage.setItem(this.RULES_KEY,JSON.stringify(o))}static getAnalysisRules(){try{const e=localStorage.getItem(this.RULES_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Erro ao recuperar regras:",e),[]}}static applyRulesToComponent(e,t){const n=this.getAnalysisRules(),o=[];let s=!1,a,r=!1;const i=n.sort((c,d)=>d.confidence-c.confidence);for(const c of i){let d=!1;if(c.condition.nodeName&&c.condition.nodeName===e?d=!0:c.condition.namePattern?new RegExp(c.condition.namePattern).test(e)&&(d=!0):c.condition.nodeType&&c.condition.nodeType===t&&(d=!0),d){if(o.push(c),c.action.ignore){r=!0;break}c.action.classify&&(a=c.action.classify),c.type==="include"&&(s=!0)}}return{shouldInclude:s,classification:a,shouldIgnore:r,appliedRules:o}}static initializeKnownPatterns(){if(this.getPatterns().length>0)return;const t=[{frameId:"8287:54836",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-54836",timestamp:Date.now(),components:{connected:1,disconnected:0}},{frameId:"8287:53586",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-53586",timestamp:Date.now(),components:{connected:0,disconnected:1}},{frameId:"8287:54843",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-54843",timestamp:Date.now(),components:{connected:1,disconnected:1}}];localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}static saveToken(e){localStorage.setItem(this.TOKEN_KEY,e)}static getToken(){return localStorage.getItem(this.TOKEN_KEY)}static clearToken(){localStorage.removeItem(this.TOKEN_KEY)}static exportToCsv(e,t){const n=["Nome do Componente","Tipo","Conectado ao DS","Prioridade","Node ID"],o=e.map(a=>[a.name,a.type,a.isConnectedToDS?"Sim":"NÃ£o",a.priority,a.nodeId]);return[n.join(","),...o.map(a=>a.join(","))].join(`
`)}static downloadCsv(e,t){const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");if(o.download!==void 0){const s=URL.createObjectURL(n);o.setAttribute("href",s),o.setAttribute("download",t),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}static downloadFile(e,t,n){const o=new Blob([e],{type:`${n};charset=utf-8;`}),s=document.createElement("a");if(s.download!==void 0){const a=URL.createObjectURL(o);s.setAttribute("href",a),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}static exportAllLearningData(){const e=this.getPatterns(),t=this.getAnalysisRules(),n=this.getLearningStats(),o={exportInfo:{timestamp:new Date().toISOString(),version:"1.0.0",sessionId:this.getOrCreateSessionId(),userAgent:navigator.userAgent},statistics:n,patterns:e,rules:t},s=`figma-learning-data-export-${Date.now()}.json`,a=JSON.stringify(o,null,2);this.downloadFile(a,s,"application/json"),console.log("ðŸ“¦ Dados de aprendizado exportados:",s)}static clearAllData(){localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.RULES_KEY)}static getLearningStats(){const e=this.getPatterns(),t=this.getAnalysisRules(),n=e.reduce((s,a)=>{var r;return s+(((r=a.feedback)==null?void 0:r.length)||0)},0),o=t.reduce((s,a)=>(s[a.type]=(s[a.type]||0)+1,s),{});return{totalPatterns:e.length,totalFeedbacks:n,totalRules:t.length,rulesBreakdown:o}}};h.STORAGE_KEY="figma-component-analysis-patterns",h.TOKEN_KEY="figma-token",h.RULES_KEY="figma-analysis-rules";let l=h;class I{static analyzeFrame(e,t){const n=[];this.extractComponents(e,n,0);const o=this.filterRelevantComponents(n),s=o.filter(r=>r.isConnectedToDS).length,a=o.filter(r=>!r.isConnectedToDS).length;return{components:o,summary:{connected:s,disconnected:a,total:s+a},frameInfo:{name:e.name,nodeId:e.id,url:t}}}static extractComponents(e,t,n){if(n===0&&e.children){e.children.forEach(s=>{this.extractComponents(s,t,n+1)});return}if(e.name.startsWith("_"))return;console.log(`ðŸ” Analisando node: "${e.name}" (${e.type}) - componentId: ${e.componentId||"null"} - depth: ${n}`);const o=l.applyRulesToComponent(e.name,e.type);if(o.shouldIgnore){console.log(`ðŸš« Ignorando componente "${e.name}" devido a regra aprendida`);return}if(e.type==="INSTANCE"){let s=!1;o.classification?s=o.classification==="connected":s=!!(e.componentId&&e.componentId.trim()!==""),console.log(`ðŸ“ INSTANCE "${e.name}": componentId="${e.componentId}" â†’ ${s?"CONECTADO":"DESCONECTADO"}`),t.push({name:e.name,type:"INSTANCE",isConnectedToDS:s,priority:this.calculatePriority(e),nodeId:e.id,depth:n}),o.appliedRules.length>0&&console.log(`ðŸŽ¯ Aplicadas ${o.appliedRules.length} regras ao componente "${e.name}"`);return}if(e.type==="COMPONENT"){let s=!1;o.classification?s=o.classification==="connected":s=!1,console.log(`ðŸ§© COMPONENT "${e.name}": â†’ ${s?"CONECTADO":"DESCONECTADO"}`),t.push({name:e.name,type:"COMPONENT",isConnectedToDS:s,priority:this.calculatePriority(e),nodeId:e.id,depth:n}),o.appliedRules.length>0&&console.log(`ðŸŽ¯ Aplicadas ${o.appliedRules.length} regras ao componente "${e.name}"`);return}if(o.shouldInclude&&(e.type==="RECTANGLE"||e.type==="TEXT"||e.type==="ELLIPSE"||e.type==="VECTOR")){const s=o.classification||"disconnected";console.log(`âœ… IncluÃ­do elemento "${e.name}" (${e.type}) devido a regra aprendida â†’ ${s.toUpperCase()}`),t.push({name:e.name,type:"OTHER",isConnectedToDS:s==="connected",priority:this.calculatePriority(e),nodeId:e.id,depth:n})}else this.shouldIncludeAsDisconnectedComponent(e,n)&&(console.log(`ðŸ”¶ Auto-detectado como componente desconectado: "${e.name}" (${e.type})`),t.push({name:e.name,type:"OTHER",isConnectedToDS:!1,priority:this.calculatePriority(e),nodeId:e.id,depth:n}));e.children&&e.children.forEach(s=>{s.type==="TEXT"&&e.type==="INSTANCE"||this.extractComponents(s,t,n+1)})}static filterRelevantComponents(e){return e.filter(t=>t.type==="INSTANCE"||t.type==="COMPONENT"?!0:t.type==="OTHER")}static shouldIncludeAsDisconnectedComponent(e,t){if(t>4||!["RECTANGLE","ELLIPSE","VECTOR","FRAME","GROUP"].includes(e.type))return!1;if(e.absoluteBoundingBox){const{width:r,height:i}=e.absoluteBoundingBox;if(r<20||i<20||r>500||i>500)return!1}const s=[/button/i,/btn/i,/card/i,/modal/i,/popup/i,/tooltip/i,/input/i,/field/i,/form/i,/checkbox/i,/radio/i,/icon/i,/avatar/i,/badge/i,/chip/i,/tag/i,/header/i,/footer/i,/sidebar/i,/menu/i,/nav/i,/component/i,/element/i,/widget/i,/rectangle \d+/i,/ellipse \d+/i,/vector \d+/i].some(r=>r.test(e.name)),a=!!(e.children&&e.children.length>0);return s||a&&t<=2}static calculatePriority(e){return e.type==="INSTANCE"?1:e.type==="COMPONENT"?2:3}static categorizeComponents(e){const t={connected:[],disconnected:[]};return e.forEach(n=>{n.isConnectedToDS?t.connected.push(n):t.disconnected.push(n)}),t}static getSuggestedMissedComponents(e){const t=[],n=(s,a)=>{a>0&&!s.name.startsWith("_")&&(s.type==="RECTANGLE"||s.type==="ELLIPSE"||s.type==="VECTOR")&&s.absoluteBoundingBox&&s.absoluteBoundingBox.width>10&&s.absoluteBoundingBox.height>10&&t.push({name:s.name,type:s.type,nodeId:s.id}),s.children&&s.type!=="INSTANCE"&&s.children.forEach(r=>n(r,a+1))};return n(e,0),t.filter((s,a,r)=>a===r.findIndex(i=>i.name===s.name)).slice(0,10)}}const f=class f{static isAuthenticated(){const e=this.getAuthData();return e?Date.now()>e.expiresAt?(this.logout(),!1):!0:!1}static login(e,t){const n=this.VALID_USERS[e];if(!n||n!==t)return!1;const o={email:e,loginTime:Date.now(),expiresAt:Date.now()+this.SESSION_DURATION};return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(o)),!0}static logout(){localStorage.removeItem(this.STORAGE_KEY)}static getAuthData(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch{return null}}static getCurrentUser(){const e=this.getAuthData();return(e==null?void 0:e.email)||null}static shouldRenewSession(){const e=this.getAuthData();if(!e)return!1;const t=e.expiresAt-Date.now(),n=60*60*1e3;return t<n}static renewSession(){const e=this.getAuthData();e&&(e.expiresAt=Date.now()+this.SESSION_DURATION,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)))}};f.STORAGE_KEY="figma-analyzer-auth",f.SESSION_DURATION=24*60*60*1e3,f.VALID_USERS={"design@qive.com":"design2024","ux@qive.com":"ux2024","admin@qive.com":"admin2024","rafael@qive.com":"dev2024"};let p=f;class S{constructor(){this.pieChart=null}updatePieChart(e){this.updatePieChartWithValues(e.summary.connected,e.summary.disconnected)}updatePieChartWithValues(e,t){const n=document.getElementById("components-chart");if(!n){console.error("Canvas do grÃ¡fico nÃ£o encontrado");return}if(typeof window.Chart>"u"){console.error("Chart.js nÃ£o estÃ¡ carregado");return}const o=e+t;if(this.pieChart){this.pieChart.data.datasets[0].data=[e,t],this.pieChart.options.plugins.tooltip.callbacks.label=a=>{const r=a.label||"",i=a.parsed,c=o>0?Math.round(i/o*100):0;return`${r}: ${i} (${c}%)`},this.pieChart.update("active"),console.log(`ðŸ“Š GrÃ¡fico atualizado: ${e} conectados, ${t} desconectados`);return}const s={type:"pie",data:{labels:["Conectados ao DS","Fora do DS"],datasets:[{data:[e,t],backgroundColor:["#10B981","#EF4444"],borderColor:["#059669","#DC2626"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,font:{size:12,family:"Inter"}}},tooltip:{callbacks:{label:a=>{const r=a.label||"",i=a.parsed,c=o>0?Math.round(i/o*100):0;return`${r}: ${i} (${c}%)`}}}}}};this.pieChart=new window.Chart(n,s),console.log(`ðŸ“Š GrÃ¡fico criado: ${e} conectados, ${t} desconectados`)}destroy(){this.pieChart&&(this.pieChart.destroy(),this.pieChart=null)}}class w{constructor(){this.chartManager=null}setChartManager(e){this.chartManager=e}updateSummaryCards(e){const t=document.querySelectorAll(".summary-card");if(t.length>=3){const r=t[0].querySelector(".summary-value");r&&(r.textContent=e.summary.connected.toString());const i=t[1].querySelector(".summary-value");i&&(i.textContent=e.summary.disconnected.toString());const c=t[2].querySelector(".summary-value");c&&(c.textContent=e.summary.total.toString())}const n=document.getElementById("connected-count");n&&(n.textContent=e.summary.connected.toString());const o=document.getElementById("disconnected-count");o&&(o.textContent=e.summary.disconnected.toString());const s=document.getElementById("compliance-rate"),a=document.getElementById("compliance-status");if(s&&a){const r=e.summary.total>0?Math.round(e.summary.connected/e.summary.total*100):0;s.textContent=`${r}%`,r>=80?(a.textContent="Aprovado",a.className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800"):(a.textContent="Revisar",a.className="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800"),a.classList.remove("hidden")}}updateComponentsTable(e){const t=document.getElementById("components-table-body");if(!t)return;const n=I.categorizeComponents(e.components);t.innerHTML="",n.connected.forEach(o=>{const s=this.createComponentRow(o,!0,e.frameInfo.url);t.appendChild(s)}),n.disconnected.forEach(o=>{const s=this.createComponentRow(o,!1,e.frameInfo.url);t.appendChild(s)}),this.setupToggleListeners()}createComponentRow(e,t,n){const o=document.createElement("tr");o.className="border-b border-gray-200 hover:bg-gray-50";const s=t?'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Conectado</span>':'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Desconectado</span>',r=`
      <label class="relative inline-flex items-center cursor-pointer justify-center">
        <input type="checkbox" id="${`toggle-${e.nodeId.replace(":","-")}`}" class="sr-only peer component-toggle" checked data-node-id="${e.nodeId}">
        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
      </label>
    `,i=this.createFigmaElementUrl(n,e.nodeId),c=i?`<a href="${i}" target="_blank" class="text-red-600 hover:text-red-800 underline font-mono text-sm" title="Abrir elemento no Figma">${e.nodeId} ðŸ”—</a>`:`<span class="font-mono text-sm text-gray-500">${e.nodeId}</span>`;return o.innerHTML=`
      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
        ${e.name}
      </td>
      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
        ${e.type}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${s}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${c}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${r}
      </td>
    `,o}createFigmaElementUrl(e,t){try{const n=new URL(e),o=t.replace(":","-");return n.searchParams.set("node-id",o),n.toString()}catch(n){return console.error("Erro ao criar URL do elemento Figma:",n),null}}setupToggleListeners(){document.querySelectorAll(".component-toggle").forEach(t=>{t.addEventListener("change",()=>{this.recalculateStats()})})}recalculateStats(){const e=document.querySelectorAll(".component-toggle");let t=0,n=0;console.log(`ðŸ”„ Recalculando estatÃ­sticas... ${e.length} toggles encontrados`),e.forEach(o=>{if(!o.checked){console.log(`â­ï¸ Toggle desabilitado para nodeId: ${o.dataset.nodeId}`);return}const s=o.closest("tr");if(!s){console.log(`âŒ Linha nÃ£o encontrada para toggle: ${o.dataset.nodeId}`);return}const a=s.querySelectorAll("span");let r=!1;a.forEach(i=>{var c;(c=i.textContent)!=null&&c.includes("Conectado")&&(r=!0)}),r?(t++,console.log(`âœ… Componente conectado contabilizado: ${o.dataset.nodeId}`)):(n++,console.log(`âŒ Componente desconectado contabilizado: ${o.dataset.nodeId}`))}),console.log(`ðŸ“Š Resultado final: ${t} conectados, ${n} desconectados`),this.updateSummaryCardsWithCustomValues(t,n),this.updateAnalysisSummary(t,n),this.chartManager&&this.chartManager.updatePieChartWithValues(t,n)}updateSummaryCardsWithCustomValues(e,t){const n=document.querySelectorAll(".summary-card .summary-value");n.length>=3&&(n[0].textContent=e.toString(),n[1].textContent=t.toString(),n[2].textContent=(e+t).toString())}updateAnalysisSummary(e,t){const n=document.getElementById("connected-count"),o=document.getElementById("disconnected-count"),s=document.getElementById("compliance-rate"),a=document.getElementById("compliance-status");if(n&&(n.textContent=e.toString()),o&&(o.textContent=t.toString()),s&&a){const r=e+t,i=r>0?Math.round(e/r*100):0;s.textContent=`${i}%`,i>=80?(a.textContent="Aprovado",a.className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800"):(a.textContent="Revisar",a.className="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800"),a.classList.remove("hidden")}console.log(`ðŸ“Š Resumo da AnÃ¡lise atualizado: ${e} conectados, ${t} desconectados`)}toggleLoadingState(e){const t=document.getElementById("analysis-status");t&&t.classList.toggle("hidden",!e)}toggleReportDropdown(e){const t=document.getElementById("report-dropdown");t&&t.classList.toggle("hidden",!e)}setupReportDropdown(){const e=document.getElementById("generate-report-btn"),t=document.getElementById("report-dropdown-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation();const o=!t.classList.contains("hidden");t.classList.toggle("hidden",o),e.setAttribute("aria-expanded",(!o).toString())}),document.addEventListener("click",()=>{t.classList.add("hidden"),e.setAttribute("aria-expanded","false")}),this.setupReportOptions())}setupReportOptions(){const e=document.getElementById("export-png");e&&e.addEventListener("click",()=>this.exportToPNG());const t=document.getElementById("export-pdf");t&&t.addEventListener("click",()=>this.exportToPDF());const n=document.getElementById("generate-link");n&&n.addEventListener("click",()=>this.generateShareableLink());const o=document.getElementById("export-checklist");o&&o.addEventListener("click",()=>this.exportChecklist())}async exportToPNG(){try{this.showSuccess("ðŸ–¼ï¸ Preparando PNG..."),setTimeout(()=>{this.showSuccess("ðŸ–¼ï¸ Funcionalidade PNG em desenvolvimento!")},1e3)}catch(e){console.error("Erro ao exportar PNG:",e),this.showError("Erro ao gerar PNG")}}async exportToPDF(){try{this.showSuccess("ðŸ“„ Preparando PDF..."),setTimeout(()=>{this.showSuccess("ðŸ“„ Funcionalidade PDF em desenvolvimento!")},1e3)}catch(e){console.error("Erro ao exportar PDF:",e),this.showError("Erro ao gerar PDF")}}generateShareableLink(){try{const e=new URL(window.location.href),t=`${e.origin}${e.pathname}?shared=true&timestamp=${Date.now()}`;navigator.clipboard.writeText(t).then(()=>{this.showSuccess("ðŸ”— Link copiado para Ã¡rea de transferÃªncia!")}).catch(()=>{const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),this.showSuccess("ðŸ”— Link copiado!")})}catch(e){console.error("Erro ao gerar link:",e),this.showError("Erro ao gerar link compartilhÃ¡vel")}}exportChecklist(){var e,t,n,o;try{const s=((e=document.getElementById("connected-count"))==null?void 0:e.textContent)||"0",a=((t=document.getElementById("disconnected-count"))==null?void 0:t.textContent)||"0",r=((n=document.getElementById("compliance-rate"))==null?void 0:n.textContent)||"0%",i=((o=document.getElementById("compliance-status"))==null?void 0:o.textContent)||"",c=`
ðŸ“‹ CHECKLIST DE AÃ‡Ã•ES - ANÃLISE DE COMPONENTES

ðŸ“Š RESUMO DA ANÃLISE:
âœ… Componentes Conectados: ${s}
âŒ Componentes Desconectados: ${a}
ðŸ“ˆ Taxa de Conformidade: ${r} (${i})

ðŸŽ¯ AÃ‡Ã•ES RECOMENDADAS:
${parseInt(a)>0?`
â–¡ Conectar ${a} componente(s) ao Design System
â–¡ Revisar elementos desconectados na tabela
â–¡ Atualizar instÃ¢ncias para usar componentes oficiais
`:"â–¡ Manter componentes jÃ¡ conectados atualizados"}

ðŸ’¡ PRÃ“XIMOS PASSOS:
â–¡ Implementar correÃ§Ãµes identificadas
â–¡ Validar mudanÃ§as no Figma
â–¡ Executar nova anÃ¡lise para verificar melhorias
â–¡ Documentar padrÃµes encontrados

ðŸ“… Data da AnÃ¡lise: ${new Date().toLocaleDateString("pt-BR")}
ðŸ•’ Hora: ${new Date().toLocaleTimeString("pt-BR")}
      `.trim(),d=new Blob([c],{type:"text/plain;charset=utf-8"}),m=URL.createObjectURL(d),u=document.createElement("a");u.href=m,u.download=`checklist-componentes-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(m),this.showSuccess("ðŸ“‹ Checklist baixado com sucesso!")}catch(s){console.error("Erro ao exportar checklist:",s),this.showError("Erro ao gerar checklist")}}toggleFeedbackButton(e){const t=document.getElementById("show-feedback-form");t&&t.classList.toggle("hidden",!e)}toggleAnalysisSections(e){const t=document.getElementById("summary-cards"),n=document.getElementById("charts-analysis"),o=document.getElementById("components-table");t&&t.classList.toggle("hidden",!e),n&&n.classList.toggle("hidden",!e),o&&o.classList.toggle("hidden",!e)}updatePatternsCount(){const e=l.getPatterns(),t=document.getElementById("patterns-count-modal");t&&(t.textContent=`${e.length}`)}toggleDetailedFeedback(e){const t=document.getElementById("feedback-drawer"),n=document.getElementById("feedback-drawer-content");t&&n&&(e?(t.classList.remove("hidden"),t.offsetHeight,n.classList.remove("translate-x-full")):(n.classList.add("translate-x-full"),setTimeout(()=>{t.classList.add("hidden")},300)))}setupFeedbackForm(){const e=document.getElementById("feedback-type"),t=document.getElementById("component-name-field"),n=document.getElementById("expected-classification-field");e&&e.addEventListener("change",()=>{const o=e.value;t&&t.classList.toggle("hidden",o!=="missed_component"&&o!=="wrong_classification"&&o!=="should_ignore"),n&&n.classList.toggle("hidden",o!=="missed_component"&&o!=="wrong_classification")})}showSuggestedComponents(e){const t=document.getElementById("suggested-components"),n=document.getElementById("suggestions-list");if(!(!t||!n)){if(e.length===0){t.classList.add("hidden");return}t.classList.remove("hidden"),n.innerHTML="",e.forEach(o=>{const s=document.createElement("div");s.className="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",s.innerHTML=`
        <div class="flex-1">
          <span class="text-sm font-medium text-gray-900">${o.name}</span>
          <span class="ml-2 text-xs text-gray-500">(${o.type})</span>
        </div>
        <button class="text-xs text-red-600 hover:text-red-800 font-medium">
          Usar este
        </button>
      `,s.addEventListener("click",()=>{const a=document.getElementById("component-name"),r=document.getElementById("feedback-type");a&&(a.value=o.name),r&&(r.value="missed_component",r.dispatchEvent(new Event("change")))}),n.appendChild(s)})}}updateLearningStats(){const e=l.getLearningStats(),t=document.getElementById("learning-stats");t&&(t.textContent=`${e.totalPatterns} padrÃµes â€¢ ${e.totalFeedbacks} feedbacks â€¢ ${e.totalRules} regras ativas`)}clearFeedbackForm(){const e=document.getElementById("detailed-feedback");if(!e)return;const t=e.querySelector("#feedback-type"),n=e.querySelector("#component-name"),o=e.querySelector("#expected-classification"),s=e.querySelector("#feedback-description");t&&(t.value=""),n&&(n.value=""),o&&(o.value=""),s&&(s.value="");const a=document.getElementById("component-name-field"),r=document.getElementById("expected-classification-field");a&&a.classList.add("hidden"),r&&r.classList.add("hidden")}collectFeedbackData(){const e=document.getElementById("feedback-type"),t=document.getElementById("component-name"),n=document.getElementById("expected-classification"),o=document.getElementById("feedback-description");if(!e||!o)return null;const s=e.value,a=o.value.trim();if(!s||!a)return this.showError("Por favor, preencha o tipo e a descriÃ§Ã£o do problema"),null;const r={type:s,description:a,timestamp:Date.now()};return t&&t.value.trim()&&(r.componentName=t.value.trim()),n&&n.value&&(r.expectedClassification=n.value),r}showError(e){const t=document.createElement("div");t.className="bg-red-50 border border-red-200 rounded-md p-4 mb-4",t.innerHTML=`
      <div class="flex">
        <svg class="h-5 w-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
        </svg>
        <div>
          <h3 class="text-sm font-medium text-red-800">Erro na anÃ¡lise</h3>
          <p class="text-sm text-red-700 mt-1">${e}</p>
        </div>
      </div>
    `;const n=document.querySelector("main");n&&n.firstChild&&n.insertBefore(t,n.firstChild),setTimeout(()=>{t.remove()},5e3)}showSuccess(e){const t=document.createElement("div");t.className="bg-green-50 border border-green-200 rounded-md p-4 mb-4",t.innerHTML=`
      <div class="flex">
        <svg class="h-5 w-5 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        </svg>
        <div>
          <h3 class="text-sm font-medium text-green-800">Sucesso</h3>
          <p class="text-sm text-green-700 mt-1">${e}</p>
        </div>
      </div>
    `;const n=document.querySelector("main");n&&n.firstChild&&n.insertBefore(t,n.firstChild),setTimeout(()=>{t.remove()},3e3)}}class v{constructor(){this.currentResult=null,this.currentFrameNode=null,this.chartManager=new S,this.uiManager=new w,this.uiManager.setChartManager(this.chartManager),this.checkAuthAndInit()}checkAuthAndInit(){p.isAuthenticated()?(this.showMainApp(),this.init()):this.showLoginScreen()}showLoginScreen(){const e=document.getElementById("login-screen"),t=document.getElementById("main-app");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),this.setupLoginListeners()}showMainApp(){const e=document.getElementById("login-screen"),t=document.getElementById("main-app");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden")}setupLoginListeners(){const e=document.getElementById("login-form");e&&e.addEventListener("submit",t=>this.handleLogin(t))}handleLogin(e){e.preventDefault();const t=document.getElementById("login-email"),n=document.getElementById("login-password");if(!t||!n)return;const o=t.value.trim(),s=n.value.trim();p.login(o,s)?(this.showMainApp(),this.init()):this.showLoginError("Email ou senha incorretos")}showLoginError(e){const t=document.querySelector(".login-error");t&&t.remove();const n=document.createElement("div");n.className="login-error bg-red-50 border border-red-200 rounded-md p-3 mt-4",n.innerHTML=`
      <div class="flex">
        <svg class="h-5 w-5 text-red-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
        </svg>
        <p class="text-sm text-red-700">${e}</p>
      </div>
    `;const o=document.getElementById("login-form");o&&o.appendChild(n)}init(){l.initializeKnownPatterns(),this.loadSavedToken(),this.uiManager.updatePatternsCount(),this.uiManager.setupFeedbackForm(),this.uiManager.updateLearningStats(),this.setupEventListeners()}setupEventListeners(){const e=document.querySelector('[onclick="analyzeFrame()"]');e&&(e.removeAttribute("onclick"),e.addEventListener("click",()=>this.analyzeFrame()));const t=document.getElementById("toggle-token-visibility");t&&t.addEventListener("click",()=>this.toggleTokenVisibility()),this.uiManager.setupReportDropdown();const n=document.getElementById("show-feedback-form");n&&n.addEventListener("click",()=>this.showFeedbackForm());const o=document.getElementById("cancel-feedback");o&&o.addEventListener("click",()=>this.cancelFeedback());const s=document.getElementById("submit-feedback");s&&s.addEventListener("click",()=>this.submitFeedback());const a=document.getElementById("figma-token");a&&a.addEventListener("input",()=>{const y=a.value.trim();y&&l.saveToken(y)});const r=document.getElementById("show-instructions"),i=document.getElementById("instructions-modal"),c=document.getElementById("close-instructions"),d=document.getElementById("close-instructions-btn");r&&i&&r.addEventListener("click",()=>{i.classList.remove("hidden")}),c&&i&&c.addEventListener("click",()=>{i.classList.add("hidden")}),d&&i&&d.addEventListener("click",()=>{i.classList.add("hidden")}),i&&i.addEventListener("click",y=>{y.target===i&&i.classList.add("hidden")});const m=document.getElementById("close-feedback-drawer"),u=document.getElementById("feedback-overlay");m&&m.addEventListener("click",()=>this.cancelFeedback()),u&&u.addEventListener("click",()=>this.cancelFeedback());const b=document.getElementById("export-learning-data");b&&b.addEventListener("click",()=>this.exportLearningData());const C=document.getElementById("logout-btn");C&&C.addEventListener("click",()=>this.handleLogout())}handleLogout(){p.logout(),this.currentResult=null,this.currentFrameNode=null,this.uiManager.toggleAnalysisSections(!1),this.uiManager.toggleReportDropdown(!1),this.uiManager.toggleFeedbackButton(!1),this.showLoginScreen()}loadSavedToken(){const e=l.getToken();if(e){const t=document.getElementById("figma-token");t&&(t.value=e)}}toggleTokenVisibility(){const e=document.getElementById("figma-token"),t=document.getElementById("eye-icon");if(e&&t){const n=e.type==="password";e.type=n?"text":"password",t.innerHTML=n?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>'}}async analyzeFrame(){const e=document.getElementById("figma-token"),t=document.getElementById("figma-url");if(!e||!t){this.uiManager.showError("Elementos de entrada nÃ£o encontrados");return}const n=e.value.trim(),o=t.value.trim();if(!n){this.uiManager.showError("Token do Figma Ã© obrigatÃ³rio");return}if(!o){this.uiManager.showError("URL do frame Ã© obrigatÃ³ria");return}this.uiManager.toggleLoadingState(!0);try{const s=E.parseUrl(o);if(!s)throw new Error("URL do Figma invÃ¡lida");const a=new E(n);if(!await a.validateToken())throw new Error("Token do Figma invÃ¡lido ou sem permissÃµes");const i=await a.fetchFrame(s.fileKey,s.nodeId);if(!i)throw new Error("Frame nÃ£o encontrado");const c=I.analyzeFrame(i,o),d=l.getPatternByFrameId(s.nodeId);d&&(console.log("PadrÃ£o conhecido encontrado:",d),d.corrections&&(c.summary.connected=d.corrections.connected,c.summary.disconnected=d.corrections.disconnected,c.summary.total=d.corrections.connected+d.corrections.disconnected)),this.currentResult=c,this.currentFrameNode=i,this.updateUI(c),this.uiManager.toggleAnalysisSections(!0),this.uiManager.toggleReportDropdown(!0),this.uiManager.toggleFeedbackButton(!0),this.uiManager.showSuccess("AnÃ¡lise concluÃ­da com sucesso!")}catch(s){console.error("Erro na anÃ¡lise:",s),this.uiManager.showError(s instanceof Error?s.message:"Erro desconhecido na anÃ¡lise")}finally{this.uiManager.toggleLoadingState(!1)}}updateUI(e){this.uiManager.updateSummaryCards(e),this.uiManager.updateComponentsTable(e),this.chartManager.updatePieChart(e)}exportLearningData(){try{l.exportAllLearningData(),this.uiManager.showSuccess("Dados exportados! Envie o arquivo para consolidaÃ§Ã£o.")}catch(e){console.error("Erro ao exportar dados:",e),this.uiManager.showError("Erro ao exportar dados de aprendizado")}}showFeedbackForm(){if(!this.currentResult||!this.currentFrameNode){this.uiManager.showError("Nenhuma anÃ¡lise ativa para dar feedback");return}this.uiManager.toggleDetailedFeedback(!0);const e=I.getSuggestedMissedComponents(this.currentFrameNode);this.uiManager.showSuggestedComponents(e),this.uiManager.updateLearningStats()}cancelFeedback(){this.uiManager.toggleDetailedFeedback(!1),this.uiManager.clearFeedbackForm()}submitFeedback(){if(!this.currentResult){this.uiManager.showError("Nenhuma anÃ¡lise ativa para dar feedback");return}const e=this.uiManager.collectFeedbackData();if(e)try{const t=E.parseUrl(this.currentResult.frameInfo.url);if(t)l.addFeedbackToPattern(t.nodeId,e),this.uiManager.showSuccess("Feedback salvo! O sistema aprendeu e um arquivo foi baixado automaticamente. Envie este arquivo para melhorar o sistema para todos!"),this.uiManager.updateLearningStats(),this.uiManager.updatePatternsCount(),this.cancelFeedback(),console.log("ðŸ“š Feedback salvo:",e),console.log("ðŸ§  Sistema aprendeu e criou novas regras automÃ¡ticas");else throw new Error("NÃ£o foi possÃ­vel identificar o frame para salvar o feedback")}catch(t){console.error("Erro ao salvar feedback:",t),this.uiManager.showError(t instanceof Error?t.message:"Erro ao salvar feedback")}}}document.addEventListener("DOMContentLoaded",()=>{new v});window.FigmaAnalyzerApp=v;
