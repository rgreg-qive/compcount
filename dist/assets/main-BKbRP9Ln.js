import{C as N,T as O}from"./themeManager-CRIQpY6X.js";class L{constructor(e){this.token=e}static parseUrl(e){try{const t=new URL(e),s=t.pathname.split("/")[2],o=t.searchParams.get("node-id");if(!o)throw new Error("node-id nÃ£o encontrado na URL");const a=o.replace("-",":");return{fileKey:s,nodeId:a}}catch(t){return console.error("Erro ao analisar URL do Figma:",t),null}}async fetchFrame(e,t){try{const n=await fetch(`https://api.figma.com/v1/files/${e}/nodes?ids=${t}`,{headers:{"X-Figma-Token":this.token}});if(!n.ok)throw new Error(`Erro da API do Figma: ${n.status} ${n.statusText}`);const o=(await n.json()).nodes[t];if(!o||!o.document)throw new Error("Frame nÃ£o encontrado");return o.document}catch(n){throw console.error("Erro ao buscar frame do Figma:",n),n}}async validateToken(){try{return(await fetch("https://api.figma.com/v1/me",{headers:{"X-Figma-Token":this.token}})).ok}catch(e){return console.error("Erro ao validar token:",e),!1}}}const x=class x{static savePattern(e){const n=this.getPatterns().filter(s=>s.frameId!==e.frameId);n.push(e),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}static getPatterns(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Erro ao recuperar padrÃµes:",e),[]}}static getPatternByFrameId(e){return this.getPatterns().find(n=>n.frameId===e)||null}static addFeedbackToPattern(e,t){const n=this.getPatterns(),s=n.findIndex(o=>o.frameId===e);if(s!==-1){n[s].feedback||(n[s].feedback=[]),n[s].feedback.push(t);const o=this.generateRulesFromFeedback(t);o.length>0&&(this.saveAnalysisRules(o),n[s].analysisRules||(n[s].analysisRules=[]),n[s].analysisRules.push(...o)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n)),this.autoSaveFeedbackToFile(e,t)}}static autoSaveFeedbackToFile(e,t){const n={timestamp:new Date().toISOString(),frameId:e,feedback:t,userAgent:navigator.userAgent,sessionId:this.getOrCreateSessionId()},s=`figma-feedback-${e}-${Date.now()}.json`,o=JSON.stringify(n,null,2);this.downloadFile(o,s,"application/json"),console.log("ðŸ“¤ Feedback salvo automaticamente:",s)}static getOrCreateSessionId(){const e="figma-analysis-session-id";let t=localStorage.getItem(e);return t||(t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(e,t)),t}static generateRulesFromFeedback(e){const t=[],n=`rule_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;switch(e.type){case"missed_component":e.componentName&&(t.push({id:n,type:"include",condition:{nodeName:e.componentName},action:{classify:e.expectedClassification||"disconnected"},confidence:.8,source:"user_feedback",createdAt:Date.now()}),e.componentName.includes("Rectangle")&&t.push({id:`${n}_pattern`,type:"include",condition:{namePattern:"Rectangle.*"},action:{classify:e.expectedClassification||"disconnected"},confidence:.6,source:"user_feedback",createdAt:Date.now()}));break;case"wrong_classification":e.componentName&&t.push({id:n,type:"classify",condition:{nodeName:e.componentName},action:{classify:e.expectedClassification||"disconnected"},confidence:.9,source:"user_feedback",createdAt:Date.now()});break;case"should_ignore":e.componentName&&t.push({id:n,type:"exclude",condition:{nodeName:e.componentName},action:{ignore:!0},confidence:.9,source:"user_feedback",createdAt:Date.now()});break}return t}static saveAnalysisRules(e){const s=[...this.getAnalysisRules(),...e].filter((o,a,i)=>a===i.findIndex(c=>c.id===o.id));localStorage.setItem(this.RULES_KEY,JSON.stringify(s))}static getAnalysisRules(){try{const e=localStorage.getItem(this.RULES_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Erro ao recuperar regras:",e),[]}}static applyRulesToComponent(e,t){const n=this.getAnalysisRules(),s=[];let o=!1,a,i=!1;const c=n.sort((r,l)=>l.confidence-r.confidence);for(const r of c){let l=!1;if(r.condition.nodeName&&r.condition.nodeName===e?l=!0:r.condition.namePattern?new RegExp(r.condition.namePattern).test(e)&&(l=!0):r.condition.nodeType&&r.condition.nodeType===t&&(l=!0),l){if(s.push(r),r.action.ignore){i=!0;break}r.action.classify&&(a=r.action.classify),r.type==="include"&&(o=!0)}}return{shouldInclude:o,classification:a,shouldIgnore:i,appliedRules:s}}static initializeKnownPatterns(){if(this.getPatterns().length>0)return;const t=[{frameId:"8287:54836",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-54836",timestamp:Date.now(),components:{connected:1,disconnected:0}},{frameId:"8287:53586",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-53586",timestamp:Date.now(),components:{connected:0,disconnected:1}},{frameId:"8287:54843",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-54843",timestamp:Date.now(),components:{connected:1,disconnected:1}}];localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}static saveToken(e){localStorage.setItem(this.TOKEN_KEY,e)}static getToken(){return localStorage.getItem(this.TOKEN_KEY)}static clearToken(){localStorage.removeItem(this.TOKEN_KEY)}static exportToCsv(e,t){const n=["Nome do Componente","Tipo","Conectado ao DS","Prioridade","Node ID"],s=e.map(a=>[a.name,a.type,a.isConnectedToDS?"Sim":"NÃ£o",a.priority,a.nodeId]);return[n.join(","),...s.map(a=>a.join(","))].join(`
`)}static downloadCsv(e,t){const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(s.download!==void 0){const o=URL.createObjectURL(n);s.setAttribute("href",o),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}static downloadFile(e,t,n){const s=new Blob([e],{type:`${n};charset=utf-8;`}),o=document.createElement("a");if(o.download!==void 0){const a=URL.createObjectURL(s);o.setAttribute("href",a),o.setAttribute("download",t),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}static exportAllLearningData(){const e=this.getPatterns(),t=this.getAnalysisRules(),n=this.getLearningStats(),s={exportInfo:{timestamp:new Date().toISOString(),version:"1.0.0",sessionId:this.getOrCreateSessionId(),userAgent:navigator.userAgent},statistics:n,patterns:e,rules:t},o=`figma-learning-data-export-${Date.now()}.json`,a=JSON.stringify(s,null,2);this.downloadFile(a,o,"application/json"),console.log("ðŸ“¦ Dados de aprendizado exportados:",o)}static clearAllData(){localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.RULES_KEY)}static getLearningStats(){const e=this.getPatterns(),t=this.getAnalysisRules(),n=e.reduce((o,a)=>{var i;return o+(((i=a.feedback)==null?void 0:i.length)||0)},0),s=t.reduce((o,a)=>(o[a.type]=(o[a.type]||0)+1,o),{});return{totalPatterns:e.length,totalFeedbacks:n,totalRules:t.length,rulesBreakdown:s}}};x.STORAGE_KEY="figma-component-analysis-patterns",x.TOKEN_KEY="figma-token",x.RULES_KEY="figma-analysis-rules";let g=x;class R{static analyzeFrame(e,t){const n=[];this.extractComponents(e,n,0);const s=this.filterRelevantComponents(n),o=s.filter(i=>i.isConnectedToDS).length,a=s.filter(i=>!i.isConnectedToDS).length;return{components:s,summary:{connected:o,disconnected:a,total:o+a},frameInfo:{name:e.name,nodeId:e.id,url:t}}}static extractComponents(e,t,n){if(n===0&&e.children){e.children.forEach(o=>{this.extractComponents(o,t,n+1)});return}if(e.name.startsWith("_"))return;console.log(`ðŸ” Analisando node: "${e.name}" (${e.type}) - componentId: ${e.componentId||"null"} - depth: ${n}`);const s=g.applyRulesToComponent(e.name,e.type);if(s.shouldIgnore){console.log(`ðŸš« Ignorando componente "${e.name}" devido a regra aprendida`);return}if(e.type==="INSTANCE"){let o=!1;s.classification?o=s.classification==="connected":o=!!(e.componentId&&e.componentId.trim()!==""),console.log(`ðŸ“ INSTANCE "${e.name}": componentId="${e.componentId}" â†’ ${o?"CONECTADO":"DESCONECTADO"}`),t.push({name:e.name,type:"INSTANCE",isConnectedToDS:o,priority:this.calculatePriority(e),nodeId:e.id,depth:n}),s.appliedRules.length>0&&console.log(`ðŸŽ¯ Aplicadas ${s.appliedRules.length} regras ao componente "${e.name}"`);return}if(e.type==="COMPONENT"){let o=!1;s.classification?o=s.classification==="connected":o=!1,console.log(`ðŸ§© COMPONENT "${e.name}": â†’ ${o?"CONECTADO":"DESCONECTADO"}`),t.push({name:e.name,type:"COMPONENT",isConnectedToDS:o,priority:this.calculatePriority(e),nodeId:e.id,depth:n}),s.appliedRules.length>0&&console.log(`ðŸŽ¯ Aplicadas ${s.appliedRules.length} regras ao componente "${e.name}"`);return}if(e.type==="TEXT"){let o=!1,a="disconnected";if(s.shouldInclude)o=!0,a=s.classification||"disconnected",console.log(`âœ… Texto incluÃ­do por regra aprendida: "${e.name}" â†’ ${a.toUpperCase()}`);else if(o=this.shouldIncludeTextComponent(e,n),o){const i=this.isTextUsingDesignSystemTokens(e);a=i?"connected":"disconnected",console.log(`ðŸ“ Texto auto-detectado: "${e.name}" (depth: ${n}) â†’ ${a.toUpperCase()} (tokens: ${i})`)}if(o){t.push({name:e.name,type:"TEXT",isConnectedToDS:a==="connected",priority:this.calculatePriority(e),nodeId:e.id,depth:n});return}}if(s.shouldInclude&&(e.type==="RECTANGLE"||e.type==="ELLIPSE"||e.type==="VECTOR")){const o=s.classification||"disconnected";console.log(`âœ… IncluÃ­do elemento "${e.name}" (${e.type}) devido a regra aprendida â†’ ${o.toUpperCase()}`),t.push({name:e.name,type:"OTHER",isConnectedToDS:o==="connected",priority:this.calculatePriority(e),nodeId:e.id,depth:n})}else this.shouldIncludeAsDisconnectedComponent(e,n)?(console.log(`ðŸ”¶ Auto-detectado como componente: "${e.name}" (${e.type})`),t.push({name:e.name,type:"OTHER",isConnectedToDS:!1,priority:this.calculatePriority(e),nodeId:e.id,depth:n})):this.shouldShowAsOption(e,n)&&(console.log(`ðŸ“‹ Adicionado como opÃ§Ã£o: "${e.name}" (${e.type}) - usuÃ¡rio decide`),t.push({name:e.name,type:"OTHER",isConnectedToDS:!1,priority:this.calculatePriority(e),nodeId:e.id,depth:n}));e.children&&e.children.forEach(o=>{this.extractComponents(o,t,n+1)})}static filterRelevantComponents(e){console.log(`ðŸ” Mostrando TODOS os componentes: ${e.length} componentes encontrados`);const t=e.filter(n=>(console.log(`âœ… Incluindo componente: "${n.name}" (${n.type})`),!0));return console.log(`ðŸ“Š Todos os componentes incluÃ­dos: ${t.length} componentes na anÃ¡lise`),t}static shouldIncludeAsDisconnectedComponent(e,t){if(t>4||!["RECTANGLE","ELLIPSE","VECTOR","FRAME","GROUP"].includes(e.type))return!1;if(e.absoluteBoundingBox){const{width:i,height:c}=e.absoluteBoundingBox;if(i<20||c<20||i>500||c>500)return!1}const o=[/button/i,/btn/i,/card/i,/modal/i,/popup/i,/tooltip/i,/input/i,/field/i,/form/i,/checkbox/i,/radio/i,/icon/i,/avatar/i,/badge/i,/chip/i,/tag/i,/header/i,/footer/i,/sidebar/i,/menu/i,/nav/i,/component/i,/element/i,/widget/i,/rectangle \d+/i,/ellipse \d+/i,/vector \d+/i].some(i=>i.test(e.name)),a=!!(e.children&&e.children.length>0);return o||a&&t<=2}static shouldShowAsOption(e,t){if(t>5||!["TEXT","RECTANGLE","ELLIPSE","VECTOR","FRAME","GROUP","LINE"].includes(e.type)||e.name.startsWith("_"))return!1;if(e.absoluteBoundingBox){const{width:s,height:o}=e.absoluteBoundingBox;if(s<5||o<5)return!1}return console.log(`ðŸ“‹ Considerando elemento como opÃ§Ã£o: "${e.name}" (${e.type}, depth: ${t})`),!0}static isTextUsingDesignSystemTokens(e){console.log(`ðŸ” DEBUG: Propriedades completas do nÃ³ TEXT "${e.name}":`,e);try{console.log("ðŸ“‹ textStyleId:",e.textStyleId),console.log("ðŸ“‹ fillStyleId:",e.fillStyleId),console.log("ðŸ“‹ styles (API REST):",e.styles),console.log("ðŸ“‹ fills (length):",e.fills?e.fills.length:"undefined"),console.log("ðŸ“‹ fills (content):",e.fills),console.log("ðŸ“‹ boundVariables:",e.boundVariables),console.log("ðŸ“‹ Todas as propriedades:",Object.keys(e));const o=["textStyleId","fillStyleId","style","styles","textStyle","fillStyle","styleId","textStyles","fillStyles","boundVariables","variables"];console.log("ðŸ“‹ Propriedades de estilo encontradas:"),o.forEach(a=>{e.hasOwnProperty(a)&&console.log(`   - ${a}:`,e[a])})}catch(o){console.log("âŒ Erro ao logar propriedades:",o)}let t=!1,n=!1;if(e.textStyleId&&e.textStyleId.trim()!==""&&(console.log(`ðŸ“ Texto "${e.name}" tem textStyleId: ${e.textStyleId}`),t=!0),e.styles&&e.styles.text&&e.styles.text.trim()!==""&&(console.log(`ðŸ“ Texto "${e.name}" tem styles.text: ${e.styles.text}`),t=!0),e.boundVariables&&Object.keys(e.boundVariables).length>0){const o=["fontFamily","fontSize","fontWeight","lineHeight","letterSpacing"];o.some(i=>e.boundVariables&&e.boundVariables[i])&&(console.log(`ðŸ“ Texto "${e.name}" tem variÃ¡veis de texto:`,Object.keys(e.boundVariables).filter(i=>o.includes(i))),t=!0)}if(e.fillStyleId&&e.fillStyleId.trim()!==""&&(console.log(`ðŸŽ¨ Texto "${e.name}" tem fillStyleId: ${e.fillStyleId}`),n=!0),e.styles&&e.styles.fill&&e.styles.fill.trim()!==""&&(console.log(`ðŸŽ¨ Texto "${e.name}" tem styles.fill: ${e.styles.fill}`),n=!0),e.fills&&Array.isArray(e.fills)&&(console.log(`ðŸ” Analisando ${e.fills.length} fills...`),e.fills.some(i=>i.boundVariables&&Object.keys(i.boundVariables).length>0)&&(console.log(`ðŸŽ¨ Texto "${e.name}" tem fills com variÃ¡veis:`,e.fills.filter(i=>i.boundVariables)),n=!0),e.fills.some(i=>i.styleId||i.fillStyleId)&&(console.log(`ðŸŽ¨ Texto "${e.name}" tem fills com styleId`),n=!0)),e.boundVariables&&Object.keys(e.boundVariables).length>0){const o=["fills","strokes","textRangeFills"];o.some(i=>e.boundVariables&&e.boundVariables[i])&&(console.log(`ðŸŽ¨ Texto "${e.name}" tem variÃ¡veis de cor:`,Object.keys(e.boundVariables).filter(i=>o.includes(i))),n=!0)}!n&&e.fills&&Array.isArray(e.fills)&&e.fills.length>0&&console.log("ðŸ” Verificando fills para cores do sistema...");const s=t&&n;return s?console.log(`âœ… Texto "${e.name}" CONECTADO - tem texto token (${t}) E cor token (${n})`):(console.log(`âŒ Texto "${e.name}" DESCONECTADO - texto token: ${t}, cor token: ${n}`),t||console.log("   âš ï¸ Faltando: token de texto (textStyleId/styles.text ou variÃ¡veis de tipografia)"),n||console.log("   âš ï¸ Faltando: token de cor (fillStyleId/styles.fill ou variÃ¡veis de cor)")),s}static shouldIncludeTextComponent(e,t){if(t>6)return console.log(`ðŸš« Texto muito profundo: "${e.name}" (depth: ${t})`),!1;if(e.absoluteBoundingBox){const{width:i,height:c}=e.absoluteBoundingBox;if(i<5||c<5)return console.log(`ðŸš« Texto muito pequeno: "${e.name}" (${i}x${c}px)`),!1;if(i>1200||c>400)return console.log(`ðŸš« Texto muito grande: "${e.name}" (${i}x${c}px)`),!1}return[/component/i,/element/i,/widget/i,/title/i,/heading/i,/header/i,/label/i,/caption/i,/subtitle/i,/button/i,/link/i,/menu/i,/nav/i,/tab/i,/capa/i,/teste/i,/demo/i,/example/i,/sample/i,/text \d+/i,/texto \d+/i,/main/i,/primary/i,/secondary/i,/content/i].some(i=>i.test(e.name))?(console.log(`âœ… Texto incluÃ­do por padrÃ£o de nome: "${e.name}"`),!0):[/^placeholder$/i,/^lorem ipsum$/i,/^sample text$/i,/^text$/i,/^label$/i,/^caption$/i].some(i=>i.test(e.name)&&i.test(e.name.trim())&&e.name.trim().length<15)?(console.log(`ðŸš« Texto excluÃ­do por ser placeholder/decorativo: "${e.name}"`),!1):(console.log(`ðŸ“ Texto incluÃ­do por critÃ©rios gerais: "${e.name}" (depth: ${t})`),!0)}static calculatePriority(e){return e.type==="INSTANCE"?1:e.type==="COMPONENT"?2:3}static categorizeComponents(e){const t={connected:[],disconnected:[]};return e.forEach(n=>{n.isConnectedToDS?t.connected.push(n):t.disconnected.push(n)}),t}static getSuggestedMissedComponents(e){const t=[],n=(o,a)=>{a>0&&!o.name.startsWith("_")&&(o.type==="RECTANGLE"||o.type==="ELLIPSE"||o.type==="VECTOR")&&o.absoluteBoundingBox&&o.absoluteBoundingBox.width>10&&o.absoluteBoundingBox.height>10&&t.push({name:o.name,type:o.type,nodeId:o.id}),o.children&&o.type!=="INSTANCE"&&o.children.forEach(i=>n(i,a+1))};return n(e,0),t.filter((o,a,i)=>a===i.findIndex(c=>c.name===o.name)).slice(0,10)}}const k=class k{static isAuthenticated(){const e=this.getAuthData();return e?Date.now()>e.expiresAt?(this.logout(),!1):!0:!1}static login(e,t){const n=this.VALID_USERS[e];if(!n||n!==t)return!1;const s={email:e,loginTime:Date.now(),expiresAt:Date.now()+this.SESSION_DURATION};return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s)),!0}static logout(){localStorage.removeItem(this.STORAGE_KEY)}static getAuthData(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch{return null}}static getCurrentUser(){const e=this.getAuthData();return(e==null?void 0:e.email)||null}static shouldRenewSession(){const e=this.getAuthData();if(!e)return!1;const t=e.expiresAt-Date.now(),n=60*60*1e3;return t<n}static renewSession(){const e=this.getAuthData();e&&(e.expiresAt=Date.now()+this.SESSION_DURATION,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)))}};k.STORAGE_KEY="figma-analyzer-auth",k.SESSION_DURATION=24*60*60*1e3,k.VALID_USERS={"design@qive.com":"design2024","ux@qive.com":"ux2024","admin@qive.com":"admin2024","rafael@qive.com":"dev2024"};let b=k;const A={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},F=E=>(A==null?void 0:A[E])||"",M={googleScriptUrl:F("VITE_GOOGLE_SCRIPT_URL")};class P{static get GOOGLE_SCRIPT_URL(){return M.googleScriptUrl}}const $=class ${static async sendFeedback(e){if(!this.SCRIPT_URL||this.SCRIPT_URL==="")return console.warn("âš ï¸ Google Apps Script URL nÃ£o configurada. Salvando apenas localmente."),!1;try{const t={...e,timestamp:e.timestamp||new Date().toISOString(),userAgent:e.userAgent||navigator.userAgent};console.log("ðŸ“¤ Enviando feedback via form submission:",t);const n=document.createElement("form");return n.method="POST",n.action=this.SCRIPT_URL,n.target="_blank",n.style.display="none",Object.entries(t).forEach(([s,o])=>{const a=document.createElement("input");a.type="hidden",a.name=s,a.value=String(o||""),n.appendChild(a)}),document.body.appendChild(n),n.submit(),setTimeout(()=>{document.body.removeChild(n)},1e3),console.log("âœ… Feedback enviado via form submission!"),!0}catch(t){return console.error("âŒ Erro ao enviar para Google Sheets:",t),!1}}static async syncPendingFeedbacks(){const e="compcount_pending_feedbacks",t=localStorage.getItem(e);if(t)try{const n=JSON.parse(t);if(n.length===0)return;console.log(`ðŸ”„ Tentando sincronizar ${n.length} feedbacks pendentes...`);let s=0;for(const o of n)await this.sendFeedback(o)&&(s++,await new Promise(i=>setTimeout(i,500)));if(s===n.length)localStorage.removeItem(e),console.log("ðŸŽ‰ Todos os feedbacks pendentes foram sincronizados!");else{const o=n.slice(s);localStorage.setItem(e,JSON.stringify(o)),console.log(`â³ ${o.length} feedbacks ainda pendentes de sincronizaÃ§Ã£o`)}}catch(n){console.error("âŒ Erro ao sincronizar feedbacks pendentes:",n)}}static saveFeedbackLocally(e){const t="compcount_pending_feedbacks",n=localStorage.getItem(t);let s=[];if(n)try{s=JSON.parse(n)}catch(o){console.error("Erro ao carregar feedbacks pendentes:",o)}s.push({...e,timestamp:e.timestamp||new Date().toISOString(),userAgent:e.userAgent||navigator.userAgent}),localStorage.setItem(t,JSON.stringify(s)),console.log("ðŸ’¾ Feedback salvo localmente para sincronizaÃ§Ã£o posterior")}static async processFeedback(e){await this.sendFeedback(e)||this.saveFeedbackLocally(e)}};$.SCRIPT_URL=P.GOOGLE_SCRIPT_URL;let v=$;class U{constructor(){this.chartManager=null,this.currentAnalysisResult=null}setChartManager(e){this.chartManager=e}updateSummaryCards(e){const t=document.querySelectorAll(".summary-card");if(t.length>=3){const i=t[0].querySelector(".summary-value");i&&(i.textContent="0");const c=t[1].querySelector(".summary-value");c&&(c.textContent="0");const r=t[2].querySelector(".summary-value");r&&(r.textContent="0")}const n=document.getElementById("connected-count");n&&(n.textContent="0");const s=document.getElementById("disconnected-count");s&&(s.textContent="0");const o=document.getElementById("compliance-rate"),a=document.getElementById("compliance-status");o&&a&&(o.textContent="0%",a.textContent="Aguardando...",a.className="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800",a.classList.remove("hidden")),console.log("ðŸ“Š Cards de resumo inicializados com zeros - aguardando cÃ¡lculo dos toggles")}updateComponentsTable(e){const t=document.getElementById("components-table-body");if(!t)return;const n=R.categorizeComponents(e.components);t.innerHTML="",n.connected.forEach(s=>{const o=this.createComponentRow(s,!0,e.frameInfo.url);t.appendChild(o)}),n.disconnected.forEach(s=>{const o=this.createComponentRow(s,!1,e.frameInfo.url);t.appendChild(o)}),this.setupToggleListeners(),setTimeout(()=>{this.recalculateStats(),console.log("ðŸ“Š EstatÃ­sticas recalculadas automaticamente apÃ³s configurar toggles")},100)}createComponentRow(e,t,n){const s=document.createElement("tr");s.className="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700";const o=t?'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">Conectado</span>':'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">Desconectado</span>',a=this.hasDesignSystemLikeName(e.name),i=e.type==="INSTANCE"||e.type==="COMPONENT"||a,l=`
      <label class="relative inline-flex items-center cursor-pointer justify-center">
        <input type="checkbox" id="${`toggle-${e.nodeId.replace(":","-")}`}" class="sr-only peer component-toggle" ${i?"checked":""} data-node-id="${e.nodeId}">
        <div class="w-11 h-6 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 dark:peer-focus:ring-red-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-500 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600 dark:peer-checked:bg-red-600"></div>
      </label>
    `,p=e.type==="INSTANCE"?"INSTANCE":e.type==="COMPONENT"?"COMPONENT":a?"NOME_DS":"OUTROS";console.log(`ðŸ”˜ Toggle para "${e.name}" (${e.type}): ${i?"LIGADO":"DESLIGADO"} por padrÃ£o (motivo: ${p})`);const f=this.createFigmaElementUrl(n,e.nodeId),h=f?`<a href="${f}" target="_blank" class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 underline font-mono text-sm" title="Abrir elemento no Figma">${e.nodeId} ðŸ”—</a>`:`<span class="font-mono text-sm text-gray-500 dark:text-gray-400">${e.nodeId}</span>`;return s.innerHTML=`
      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
        ${e.name}
      </td>
      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
        ${e.type}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${o}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${h}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${l}
      </td>
    `,s}createFigmaElementUrl(e,t){try{const n=new URL(e),s=t.replace(":","-");return n.searchParams.set("node-id",s),n.toString()}catch(n){return console.error("Erro ao criar URL do elemento Figma:",n),null}}setupToggleListeners(){document.querySelectorAll(".component-toggle").forEach(t=>{t.addEventListener("change",()=>{this.recalculateStats()})})}recalculateStats(){const e=document.querySelectorAll(".component-toggle");let t=0,n=0;console.log(`ðŸ”„ Recalculando estatÃ­sticas... ${e.length} toggles encontrados`),e.forEach(s=>{if(!s.checked){console.log(`â­ï¸ Toggle desabilitado para nodeId: ${s.dataset.nodeId}`);return}const o=s.closest("tr");if(!o){console.log(`âŒ Linha nÃ£o encontrada para toggle: ${s.dataset.nodeId}`);return}const a=o.querySelectorAll("span");let i=!1;a.forEach(c=>{var r;(r=c.textContent)!=null&&r.includes("Conectado")&&(i=!0)}),i?(t++,console.log(`âœ… Componente conectado contabilizado: ${s.dataset.nodeId}`)):(n++,console.log(`âŒ Componente desconectado contabilizado: ${s.dataset.nodeId}`))}),console.log(`ðŸ“Š Resultado final: ${t} conectados, ${n} desconectados`),this.updateSummaryCardsWithCustomValues(t,n),this.updateAnalysisSummary(t,n),this.chartManager&&this.chartManager.updatePieChartWithValues(t,n)}updateSummaryCardsWithCustomValues(e,t){const n=document.querySelectorAll(".summary-card .summary-value");n.length>=3&&(n[0].textContent=e.toString(),n[1].textContent=t.toString(),n[2].textContent=(e+t).toString())}updateAnalysisSummary(e,t){const n=document.getElementById("connected-count"),s=document.getElementById("disconnected-count"),o=document.getElementById("compliance-rate"),a=document.getElementById("compliance-status");if(n&&(n.textContent=e.toString()),s&&(s.textContent=t.toString()),o&&a){const i=e+t,c=i>0?Math.round(e/i*100):0;o.textContent=`${c}%`,c>=80?(a.textContent="Aprovado",a.className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800"):(a.textContent="Revisar",a.className="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800"),a.classList.remove("hidden")}console.log(`ðŸ“Š Resumo da AnÃ¡lise atualizado: ${e} conectados, ${t} desconectados`)}toggleLoadingState(e){const t=document.getElementById("analysis-status");t&&t.classList.toggle("hidden",!e)}toggleReportDropdown(e){const t=document.getElementById("report-dropdown");t&&t.classList.toggle("hidden",!e)}setupReportDropdown(){const e=document.getElementById("generate-report-btn"),t=document.getElementById("report-dropdown-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation();const s=!t.classList.contains("hidden");t.classList.toggle("hidden",s),e.setAttribute("aria-expanded",(!s).toString())}),document.addEventListener("click",()=>{t.classList.add("hidden"),e.setAttribute("aria-expanded","false")}),this.setupReportOptions())}setupReportOptions(){const e=document.getElementById("export-png");e&&e.addEventListener("click",()=>this.showWipMessage("PNG"));const t=document.getElementById("export-pdf");t&&t.addEventListener("click",()=>this.showWipMessage("PDF"));const n=document.getElementById("generate-link");n&&n.addEventListener("click",()=>this.generateShareableLink());const s=document.getElementById("export-checklist");s&&s.addEventListener("click",()=>this.showWipMessage("Checklist"))}showWipMessage(e){this.showError(`ðŸš§ ${e} em desenvolvimento! Use "Gerar Link" por enquanto.`)}generateShareableLink(){var e,t,n,s,o,a,i,c;try{if(!this.currentAnalysisResult){this.showError("Nenhuma anÃ¡lise disponÃ­vel para compartilhar");return}const r=((e=document.getElementById("connected-count"))==null?void 0:e.textContent)||"0",l=((t=document.getElementById("disconnected-count"))==null?void 0:t.textContent)||"0",p=((n=document.getElementById("compliance-rate"))==null?void 0:n.textContent)||"0%",f=((s=document.getElementById("compliance-status"))==null?void 0:s.textContent)||"",h=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,S=this.getExcludedComponents(),u={frameInfo:this.currentAnalysisResult.frameInfo,summary:this.currentAnalysisResult.summary,components:this.currentAnalysisResult.components,excludedComponents:S,timestamp:Date.now(),complianceRate:parseFloat(p.replace("%","")),complianceStatus:f,analysisId:h},m=`shared-analysis-${h}`,I=JSON.stringify(u);try{localStorage.setItem(m,I),console.log("âœ… Dados salvos no localStorage com chave:",m),sessionStorage.setItem(m,I),console.log("âœ… Dados salvos no sessionStorage como backup");const d=`shared-analysis-${Date.now()}`;localStorage.setItem(d,I),console.log("âœ… Dados salvos com chave alternativa:",d),console.log("ðŸ“Š Dados completos sendo salvos:",{frameInfo:u.frameInfo,totalComponents:((o=u.components)==null?void 0:o.length)||0,componentNames:((a=u.components)==null?void 0:a.slice(0,3).map(T=>T.name))||[],excludedComponents:((i=u.excludedComponents)==null?void 0:i.length)||0})}catch(d){console.error("âŒ Erro ao salvar dados:",d),this.showError("Erro ao salvar dados da anÃ¡lise");return}const D={frameInfo:u.frameInfo,components:u.components.map(d=>({name:d.name,type:d.type,isConnectedToDS:d.isConnectedToDS,nodeId:d.nodeId})),excludedComponents:((c=u.excludedComponents)==null?void 0:c.map(d=>({name:d.name,type:d.type,isConnectedToDS:d.isConnectedToDS,nodeId:d.nodeId})))||[],summary:u.summary,complianceRate:u.complianceRate,complianceStatus:u.complianceStatus,timestamp:u.timestamp},w=JSON.stringify(D);console.log("ðŸ“¦ Dados compactos:",{originalSize:I.length,compactSize:w.length,reduction:Math.round((1-w.length/I.length)*100)+"%"});let y="",C=!1;try{const d=encodeURIComponent(btoa(w));y=`${new URL(window.location.href).origin}/view.html?shared=true&id=${h}&data=${d}&connected=${r}&disconnected=${l}&compliance=${encodeURIComponent(p)}&status=${encodeURIComponent(f)}&timestamp=${Date.now()}`,C=!0,console.log("âœ… URL com dados completos criada (tamanho:",y.length,"chars)"),console.log("ðŸ”— URL preview:",y.substring(0,150)+"...")}catch(d){console.error("âŒ Erro ao codificar dados:",d),y=`${new URL(window.location.href).origin}/view.html?shared=true&id=${h}&connected=${r}&disconnected=${l}&compliance=${encodeURIComponent(p)}&status=${encodeURIComponent(f)}&timestamp=${Date.now()}`,C=!1,console.log("âš ï¸ Fallback: URL sem dados codificados")}navigator.clipboard.writeText(y).then(()=>{this.showSuccess("ðŸ”— Link da anÃ¡lise copiado! Compartilhe com sua equipe.")}).catch(()=>{const d=document.createElement("textarea");d.value=y,document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d),this.showSuccess("ðŸ”— Link da anÃ¡lise copiado!")}),console.log("ðŸ“Š Link gerado com dados completos:",{analysisId:h,connected:r,disconnected:l,compliance:p,status:f,url:y,fullDataSaved:!0,dataIncluded:C,urlLength:y.length})}catch(r){console.error("Erro ao gerar link:",r),this.showError("Erro ao gerar link compartilhÃ¡vel")}}setCurrentAnalysisResult(e){this.currentAnalysisResult=e}getExcludedComponents(){const e=[];if(!this.currentAnalysisResult)return e;try{document.querySelectorAll(".component-toggle").forEach(n=>{if(!n.checked){const s=n.dataset.nodeId,o=this.currentAnalysisResult.components.find(a=>a.nodeId===s);o&&e.push(o)}})}catch(t){console.warn("Erro ao coletar componentes excluÃ­dos:",t)}return e}toggleFeedbackButton(e){const t=document.getElementById("show-feedback-form");t&&t.classList.toggle("hidden",!e)}toggleAnalysisSections(e){const t=document.getElementById("summary-cards"),n=document.getElementById("charts-analysis"),s=document.getElementById("components-table");t&&t.classList.toggle("hidden",!e),n&&n.classList.toggle("hidden",!e),s&&s.classList.toggle("hidden",!e)}updatePatternsCount(){const e=g.getPatterns(),t=document.getElementById("patterns-count-modal");t&&(t.textContent=`${e.length}`)}toggleDetailedFeedback(e){const t=document.getElementById("feedback-drawer"),n=document.getElementById("feedback-drawer-content");t&&n&&(e?(t.classList.remove("hidden"),t.offsetHeight,n.classList.remove("translate-x-full")):(n.classList.add("translate-x-full"),setTimeout(()=>{t.classList.add("hidden")},300)))}setupFeedbackForm(){const e=document.getElementById("feedback-type"),t=document.getElementById("component-name-field"),n=document.getElementById("expected-classification-field");e&&e.addEventListener("change",()=>{const s=e.value;t&&t.classList.toggle("hidden",s!=="missed_component"&&s!=="wrong_classification"&&s!=="should_ignore"),n&&n.classList.toggle("hidden",s!=="missed_component"&&s!=="wrong_classification")})}showSuggestedComponents(e){const t=document.getElementById("suggested-components"),n=document.getElementById("suggestions-list");if(!(!t||!n)){if(e.length===0){t.classList.add("hidden");return}t.classList.remove("hidden"),n.innerHTML="",e.forEach(s=>{const o=document.createElement("div");o.className="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",o.innerHTML=`
        <div class="flex-1">
          <span class="text-sm font-medium text-gray-900">${s.name}</span>
          <span class="ml-2 text-xs text-gray-500">(${s.type})</span>
        </div>
        <button class="text-xs text-red-600 hover:text-red-800 font-medium">
          Usar este
        </button>
      `,o.addEventListener("click",()=>{const a=document.getElementById("component-name"),i=document.getElementById("feedback-type");a&&(a.value=s.name),i&&(i.value="missed_component",i.dispatchEvent(new Event("change")))}),n.appendChild(o)})}}updateLearningStats(){const e=g.getLearningStats(),t=document.getElementById("learning-stats");t&&(t.textContent=`${e.totalPatterns} padrÃµes â€¢ ${e.totalFeedbacks} feedbacks â€¢ ${e.totalRules} regras ativas`)}clearFeedbackForm(){const e=document.getElementById("detailed-feedback");if(!e)return;const t=e.querySelector("#feedback-type"),n=e.querySelector("#component-name"),s=e.querySelector("#expected-classification"),o=e.querySelector("#feedback-description");t&&(t.value=""),n&&(n.value=""),s&&(s.value=""),o&&(o.value="");const a=document.getElementById("component-name-field"),i=document.getElementById("expected-classification-field");a&&a.classList.add("hidden"),i&&i.classList.add("hidden")}collectFeedbackData(){const e=document.getElementById("feedback-type"),t=document.getElementById("component-name"),n=document.getElementById("expected-classification"),s=document.getElementById("feedback-description");if(!e||!s)return null;const o=e.value,a=s.value.trim();if(!o||!a)return this.showError("Por favor, preencha o tipo e a descriÃ§Ã£o do problema"),null;const i={type:o,description:a,timestamp:Date.now()};return t&&t.value.trim()&&(i.componentName=t.value.trim()),n&&n.value&&(i.expectedClassification=n.value),i}showError(e){this.showSnackbar(e,"error")}showSuccess(e){this.showSnackbar(e,"success")}showSnackbar(e,t){const n=document.getElementById("snackbar-container");if(!n)return;const s=document.createElement("div"),o=`snackbar-${Date.now()}`;s.id=o;const a="pointer-events-auto mb-3 px-4 py-3 rounded-lg shadow-lg border flex items-center min-w-96 max-w-md mx-auto transition-all duration-300 ease-out transform",i=t==="success"?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800";s.className=`${a} ${i} translate-y-0 opacity-100`;const c=t==="success"?`<svg class="w-5 h-5 text-green-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
           <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
         </svg>`:`<svg class="w-5 h-5 text-red-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
           <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
         </svg>`;s.innerHTML=`
      <div class="flex items-center w-full">
        ${c}
        <div class="ml-3 flex-1">
          <p class="text-sm font-medium">${e}</p>
        </div>
        <button 
          class="ml-3 flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors"
          onclick="this.closest('[id^=snackbar-]').remove()"
          aria-label="Fechar"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
        </button>
      </div>
    `,s.style.transform="translateY(-20px)",s.style.opacity="0",n.appendChild(s),requestAnimationFrame(()=>{s.style.transform="translateY(0)",s.style.opacity="1"}),setTimeout(()=>{this.hideSnackbar(o)},4e3)}hideSnackbar(e){const t=document.getElementById(e);t&&(t.style.transform="translateY(-20px)",t.style.opacity="0",setTimeout(()=>{t.parentNode&&t.remove()},300))}hasDesignSystemLikeName(e){return[/button/i,/btn/i,/botao/i,/botÃ£o/i,/card/i,/cartao/i,/cartÃ£o/i,/modal/i,/popup/i,/dialog/i,/overlay/i,/tooltip/i,/popover/i,/dropdown/i,/input/i,/field/i,/form/i,/campo/i,/checkbox/i,/radio/i,/switch/i,/toggle/i,/select/i,/option/i,/picker/i,/textarea/i,/textfield/i,/menu/i,/nav/i,/navigation/i,/navbar/i,/breadcrumb/i,/tab/i,/aba/i,/guia/i,/sidebar/i,/drawer/i,/header/i,/footer/i,/alert/i,/notification/i,/toast/i,/snackbar/i,/badge/i,/tag/i,/chip/i,/pill/i,/loading/i,/spinner/i,/skeleton/i,/avatar/i,/profile/i,/image/i,/icon/i,/list/i,/item/i,/grid/i,/table/i,/accordion/i,/collapse/i,/panel/i,/component/i,/elemento/i,/widget/i,/design.?system/i,/ds.?/i,/ui.?kit/i,/template/i,/layout/i,/container/i,/^(base|primary|secondary)/i,/\/(button|card|modal|input)/i,/button$/i,/card$/i,/modal$/i,/label/i,/title/i,/heading/i,/caption/i,/link/i,/texto/i,/text/i,/capa/i,/teste/i,/demo/i,/example/i].some(s=>s.test(e))?(console.log(`ðŸŽ¯ Nome "${e}" identificado como Design System - toggle serÃ¡ LIGADO por padrÃ£o`),!0):!1}}class B{constructor(){this.currentResult=null,this.currentFrameNode=null,this.chartManager=new N,this.uiManager=new U,new O,this.uiManager.setChartManager(this.chartManager),this.checkAuthAndInit()}checkAuthAndInit(){b.isAuthenticated()?(this.showMainApp(),this.init()):this.showLoginScreen()}showLoginScreen(){const e=document.getElementById("login-screen"),t=document.getElementById("main-app");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),this.setupLoginListeners()}showMainApp(){const e=document.getElementById("login-screen"),t=document.getElementById("main-app");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden")}setupLoginListeners(){const e=document.getElementById("login-form");e&&e.addEventListener("submit",t=>this.handleLogin(t))}handleLogin(e){e.preventDefault();const t=document.getElementById("login-email"),n=document.getElementById("login-password");if(!t||!n)return;const s=t.value.trim(),o=n.value.trim();b.login(s,o)?(this.showMainApp(),this.init()):this.showLoginError("Email ou senha incorretos")}showLoginError(e){const t=document.querySelector(".login-error");t&&t.remove();const n=document.createElement("div");n.className="login-error bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-md p-3 mt-4",n.innerHTML=`
      <div class="flex">
        <svg class="h-5 w-5 text-red-400 dark:text-red-300 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
        </svg>
        <p class="text-sm text-red-700 dark:text-red-300">${e}</p>
      </div>
    `;const s=document.getElementById("login-form");s&&s.appendChild(n)}async init(){console.log("ðŸš€ Iniciando Figma Component Analyzer..."),g.initializeKnownPatterns(),this.loadSavedToken(),this.uiManager.updatePatternsCount(),this.uiManager.setupFeedbackForm(),this.uiManager.updateLearningStats(),this.syncPendingFeedbacks(),this.setupEventListeners()}async syncPendingFeedbacks(){try{await v.syncPendingFeedbacks()}catch(e){console.error("Erro na sincronizaÃ§Ã£o automÃ¡tica:",e)}}setupEventListeners(){const e=document.querySelector('[onclick="analyzeFrame()"]');e&&(e.removeAttribute("onclick"),e.addEventListener("click",()=>this.analyzeFrame()));const t=document.getElementById("toggle-token-visibility");t&&t.addEventListener("click",()=>this.toggleTokenVisibility()),this.uiManager.setupReportDropdown();const n=document.getElementById("show-feedback-form");n&&n.addEventListener("click",()=>this.showFeedbackForm());const s=document.getElementById("cancel-feedback");s&&s.addEventListener("click",()=>this.cancelFeedback());const o=document.getElementById("submit-feedback");o&&o.addEventListener("click",()=>this.submitFeedback());const a=document.getElementById("figma-token");a&&a.addEventListener("input",()=>{const m=a.value.trim();m&&g.saveToken(m)});const i=document.getElementById("figma-url");i&&i.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),this.analyzeFrame())});const c=document.getElementById("show-instructions"),r=document.getElementById("instructions-modal"),l=document.getElementById("close-instructions"),p=document.getElementById("close-instructions-btn");c&&r&&c.addEventListener("click",()=>{r.classList.remove("hidden")}),l&&r&&l.addEventListener("click",()=>{r.classList.add("hidden")}),p&&r&&p.addEventListener("click",()=>{r.classList.add("hidden")}),r&&r.addEventListener("click",m=>{m.target===r&&r.classList.add("hidden")});const f=document.getElementById("close-feedback-drawer"),h=document.getElementById("feedback-overlay");f&&f.addEventListener("click",()=>this.cancelFeedback()),h&&h.addEventListener("click",()=>this.cancelFeedback());const S=document.getElementById("export-learning-data");S&&S.addEventListener("click",()=>this.exportLearningData());const u=document.getElementById("logout-btn");u&&u.addEventListener("click",()=>this.handleLogout())}handleLogout(){b.logout(),this.currentResult=null,this.currentFrameNode=null,this.uiManager.toggleAnalysisSections(!1),this.uiManager.toggleReportDropdown(!1),this.uiManager.toggleFeedbackButton(!1),this.showLoginScreen()}loadSavedToken(){const e=g.getToken();if(e){const t=document.getElementById("figma-token");t&&(t.value=e)}}toggleTokenVisibility(){const e=document.getElementById("figma-token"),t=document.getElementById("eye-icon");if(e&&t){const n=e.type==="password";e.type=n?"text":"password",t.innerHTML=n?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>'}}async analyzeFrame(){const e=document.getElementById("figma-token"),t=document.getElementById("figma-url");if(!e||!t){this.uiManager.showError("Elementos de entrada nÃ£o encontrados");return}const n=e.value.trim(),s=t.value.trim();if(!n){this.uiManager.showError("Token do Figma Ã© obrigatÃ³rio");return}if(!s){this.uiManager.showError("URL do frame Ã© obrigatÃ³ria");return}this.uiManager.toggleLoadingState(!0);try{const o=L.parseUrl(s);if(!o)throw new Error("URL do Figma invÃ¡lida");const a=new L(n);if(!await a.validateToken())throw new Error("Token do Figma invÃ¡lido ou sem permissÃµes");const c=await a.fetchFrame(o.fileKey,o.nodeId);if(!c)throw new Error("Frame nÃ£o encontrado");const r=R.analyzeFrame(c,s),l=g.getPatternByFrameId(o.nodeId);l&&(console.log("PadrÃ£o conhecido encontrado:",l),l.corrections&&(r.summary.connected=l.corrections.connected,r.summary.disconnected=l.corrections.disconnected,r.summary.total=l.corrections.connected+l.corrections.disconnected)),this.currentResult=r,this.currentFrameNode=c,this.uiManager.setCurrentAnalysisResult(r),this.updateUI(r),this.uiManager.toggleAnalysisSections(!0),this.uiManager.toggleReportDropdown(!0),this.uiManager.toggleFeedbackButton(!0),this.uiManager.showSuccess("AnÃ¡lise concluÃ­da com sucesso!")}catch(o){console.error("Erro na anÃ¡lise:",o),this.uiManager.showError(o instanceof Error?o.message:"Erro desconhecido na anÃ¡lise")}finally{this.uiManager.toggleLoadingState(!1)}}updateUI(e){this.uiManager.updateSummaryCards(e),this.uiManager.updateComponentsTable(e),this.chartManager.updatePieChart(e)}exportLearningData(){try{g.exportAllLearningData(),this.uiManager.showSuccess("Dados exportados! Envie o arquivo para consolidaÃ§Ã£o.")}catch(e){console.error("Erro ao exportar dados:",e),this.uiManager.showError("Erro ao exportar dados de aprendizado")}}showFeedbackForm(){if(!this.currentResult||!this.currentFrameNode){this.uiManager.showError("Nenhuma anÃ¡lise ativa para dar feedback");return}this.uiManager.toggleDetailedFeedback(!0);const e=R.getSuggestedMissedComponents(this.currentFrameNode);this.uiManager.showSuggestedComponents(e),this.uiManager.updateLearningStats()}cancelFeedback(){this.uiManager.toggleDetailedFeedback(!1),this.uiManager.clearFeedbackForm()}async submitFeedback(){if(!this.currentResult){this.uiManager.showError("Nenhuma anÃ¡lise ativa para dar feedback");return}const e=this.uiManager.collectFeedbackData();if(!e)return;const t=document.getElementById("submit-feedback"),n=t==null?void 0:t.innerHTML;t&&(t.disabled=!0,t.innerHTML="â³ Enviando...");try{const o={usuario:b.getCurrentUser()||"usuÃ¡rio nÃ£o identificado",frameUrl:this.currentResult.frameInfo.url,tipoProblema:e.type,nomeComponente:e.componentName,classificacaoEsperada:e.expectedClassification,descricao:e.description};await v.processFeedback(o);const a=L.parseUrl(this.currentResult.frameInfo.url);if(a)g.addFeedbackToPattern(a.nodeId,e),this.uiManager.showSuccess("âœ… Feedback processado com sucesso! O sistema aprendeu com seu feedback."),this.uiManager.updateLearningStats(),this.uiManager.updatePatternsCount(),this.cancelFeedback(),console.log("ðŸ“š Feedback salvo:",e),console.log("ðŸ“Š Dados enviados para planilha:",o),console.log("ðŸ§  Sistema aprendeu e criou novas regras automÃ¡ticas");else throw new Error("NÃ£o foi possÃ­vel identificar o frame para salvar o feedback")}catch(s){console.error("Erro ao processar feedback:",s),this.uiManager.showError(s instanceof Error?s.message:"Erro ao processar feedback")}finally{t&&n&&(t.disabled=!1,t.innerHTML=n)}}}document.addEventListener("DOMContentLoaded",()=>{new B});window.FigmaAnalyzerApp=B;
